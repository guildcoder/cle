<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Bidding</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Live Bidding Board</h1>
  <div id="lots"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBri9ILoCR21RS1ow2epFocbka63sLOSEM",
      authDomain: "dugout-live-96480.firebaseapp.com",
      projectId: "dugout-live-96480",
      storageBucket: "dugout-live-96480.firebasestorage.app",
      messagingSenderId: "183818216509",
      appId: "1:183818216509:web:792137f59b46123446b654",
      measurementId: "G-43HN5BNN92"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const lotsContainer = document.getElementById("lots");

    onSnapshot(collection(db, "lots"), (snapshot) => {
      lotsContainer.innerHTML = "";
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const lotDiv = document.createElement("div");
        lotDiv.className = "lot";
        lotDiv.innerHTML = `
          <img src="${data.imageUrl}" alt="${data.title}" width="200"><br>
          <h2>${data.title}</h2>
          <p>${data.pedigree}</p>
          <p>${data.description}</p>
          <p><strong>Current Bid:</strong> $${data.currentBid}</p>
          <button class="bidButton" data-id="${docSnap.id}">Place Bid</button>
        `;
        lotsContainer.appendChild(lotDiv);
      });

      document.querySelectorAll(".bidButton").forEach(btn => {
        btn.addEventListener("click", async () => {
          const id = btn.dataset.id;
          const name = prompt("Enter your full name:");
          const phone1 = prompt("Enter your phone number:");
          const phone2 = prompt("Confirm your phone number:");
          if (phone1 !== phone2) return alert("Phone numbers do not match.");
          const bidAmount = parseFloat(prompt("Enter your bid amount:"));

          const lotRef = doc(db, "lots", id);
          const docSnap = await getDoc(lotRef);
          const lot = docSnap.data();

          if (bidAmount % lot.increment !== 0) {
            return alert(`Bids must be divisible by $${lot.increment}`);
          }

          if (bidAmount <= lot.currentBid) {
            return alert("Your bid must be higher than the current bid.");
          }

          const bidNumber = Math.floor(Math.random() * 1000000);
          await updateDoc(lotRef, {
            currentBid: bidAmount,
            highestBidder: { name, phone: phone1, bidNumber }
          });

          alert(`Thank you for your bid! Your bid # is ${bidNumber}.`);
        });
      });
    });
  </script>
</body>
</html>
